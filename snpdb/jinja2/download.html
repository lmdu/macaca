{% set urlname="retrieve" %}
{% extends "base.html" %}

{% block main %}
<form action="{{ url('retrieve') }}" method="get" id="snps-filter">
<input type="hidden" id="page" name="page" value="{{ paras.page }}">
<input type="hidden" name="chr" value="{{ paras.chromosome }}">
<input type="hidden" name="start" value="{{ paras.start }}">
<input type="hidden" name="end" value="{{ paras.end }}">
<input type="hidden" name="category" value="{{ paras.category }}">
<input type="hidden" name="group" value="{{ paras.group }}">
<input type="hidden" name="species" value="{{ paras.species }}">
{% for individual in paras.individuals %}
<input type="hidden" name="individuals" value="{{ individual }}">
{% endfor %}
<input type="hidden" name="feature" value="{{ paras.feature }}">
<input type="hidden" name="genotype" value="{{ paras.genotype }}">
<input type="hidden" name="mutation" value="{{ paras.mutation }}">
<input type="hidden" name="gene" value="{{ paras.gene }}">
<div class="ui grid">
	<div class="eight wide column">
		Show
		<select name="records" class="ui numperpage compact selection dropdown">
			{% set pages=[10, 25, 50, 100] %}
			{% for v in pages %}
			<option value="{{v}}" {% if paras.records==v %} selected="selected" {% endif %}>{{v}}</option>
			{% endfor %}
		</select>
		entries
	</div>

	<div class="right aligned eight wide column">
		<div class="ui basic result segment">
			<span>{{ snps.paginator.count }} SNPs</span>
			<span>{{ snps.number }} of {{ snps.paginator.num_pages }} Pages</span>
		</div>
	</div>
</div>

<table class="ui celled table">
	<thead>
		<tr>
			<th>
				<div class="ui master fitted checkbox">
					<input type="checkbox" name="" class="hidden">
				</div>
			</th>
			<th>SNP ID</th>
			<th>Position</th>
			<th>{{ paras.category }}</th>
			<th>Reference</th>
			<th>Alteration</th>
			<th>Genotype</th>
		</tr>
	</thead>
	<tbody>
		{% for snp in snps %}
		<tr>
			<td>
				<div class="ui child fitted checkbox">
					<input type="checkbox" name="" class="hidden">
				</div>
			</td>
			<td>
				{% if paras.category == "individual" %}
				<a href="{{ url('snpid', kwargs={'indiv': '%03d'|format(snp.individual.id), 'sid':'%09d'|format(snp.snp.id)}) }}">MACSNP{{"%03d%09d"|format(snp.individual.id,snp.snp.id)}}</a>
				{% elif paras.category == "group" %}
				<a href="{{ url('snpid', kwargs={'cat':'G', 'cid': '%02d'|format(snp.group.id), 'sid':'%09d'|format(snp.snp.id)}) }}">MACSNP{{"%03d%09d"|format(snp.individual.id,snp.snp.id)}}</a>
				{% elif paras.category == "species" %}
				<a href="{{ url('snpid', kwargs={'cat':'S', 'cid': '%02d'|format(snp.group.id), 'sid':'%09d'|format(snp.snp.id)}) }}">MACSNP{{"%03d%09d"|format(snp.individual.id,snp.snp.id)}}</a>
				{% endif %}
			</td>
			<td>{{snp.snp.chromosome.name}}: {{snp.snp.position}}</td>
			<td>
				{% if paras.category == "individual" %}
				{{snp.individual.code}}
				{% elif paras.category == "group" %}
				{{ snp.group.name }}
				{% elif paras.category == "species" %}
				{{ snp.species.common }}
				{% endif %}
			</td>
			<td>{{snp.snp.reference}}</td>
			<td>{{snp.snp.alteration}}</td>
			<td>
				{% if paras.category == "individual" %}
				{% if snp.genotype == 1 %}
				<span class="genotype homo">homozygote</span>
				{% else %}
				<span class="genotype hetero">heterozygote</span>
				{% endif %}
				{% else %}
				<span class="genotype homo">homozygote</span>
				{% endif %}
			</td>
		</tr>
		{% else %}
		<tr><td colspan="7" class="center aligned">No Results Found</td></tr>
		{% endfor %}

	</tbody>
	<tfoot>
		<tr><th colspan="7">
		<div class="ui download left labeled button">
			<div class="ui basic label">0</div>
			<button class="ui small button"><i class="icon download"></i> Download</button>
		</div>

		<div class="ui pager right floated pagination menu">
			{% if snps.has_previous() %}
			<a class="icon item" data-num="{{ snps.previous_page_number() }}">
				<i class="left chevron icon"></i>
			</a>
			{% endif %}

			{% for i in range(3, 0, -1) %}
			{% if snps.number - i > 0 %}
			<a class="item" data-num="{{snps.number-i}}">{{snps.number-i}}</a>
			{% endif %}
			{% endfor %}
			
			<span class="item active" data-num="{{snps.number}}">{{snps.number}}</span>
			
			{% for i in range(1, 4) %}
			{% if snps.number + i <= snps.paginator.num_pages %}
			<a class="item" data-num="{{snps.number+i}}">{{snps.number+i}}</a>
			{% endif %}
			{% endfor %}

			{% if snps.has_next() %}
			<a class="icon item" data-num="{{ snps.next_page_number() }}">
				<i class="right chevron icon"></i>
			</a>
			{% endif %}
		</div>
	</th></tr>
	</tfoot>
</table>

</form>

{% endblock %}